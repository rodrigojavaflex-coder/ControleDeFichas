@if (currentUser) {
<nav class="sidebar">
  <!-- Menu principal -->
  <div class="sidebar-content">
    <nav class="main-nav">
      <ul class="nav-list">
        @for (item of visibleMenuItems; track item.label) {
        <li class="nav-item">
          @if (item.children) {
            <!-- Item com submenu -->
            <div 
              class="nav-link submenu-toggle"
              [class.active]="isSubmenuActive(item)"
              [attr.title]="!shouldShowExpanded ? item.label : null"
              (click)="toggleSubmenu(item)"
            >
              <span class="nav-icon">
                @if (item.icon === 'feather-cog') {
                  <svg width="28" height="28" fill="none" stroke="rgba(100,116,139,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 17.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 6.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                }
                @if (item.icon === 'feather-file-text') {
                  <svg width="28" height="28" fill="none" stroke="rgba(100,116,139,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                }
              </span>
              @if (shouldShowExpanded) {
                <span class="nav-text">{{ item.label }}</span>
                <span class="submenu-arrow" [class.open]="item.isOpen">▶</span>
              }
            </div>
            
            <!-- Submenu -->
            @if (item.children && item.isOpen) {
              <ul class="submenu">
                @for (child of item.children; track child.route) {
                <li class="submenu-item">
                  <a 
                    [routerLink]="child.route" 
                    [class.active]="child.route && isRouteActive(child.route)"
                    class="nav-link submenu-link"
                    [attr.title]="!shouldShowExpanded ? child.label : null"
                    (click)="onMenuItemClick()"
                  >
                    <span class="submenu-icon">
                      @if (child.icon === 'feather-eye') {
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                      }
                      @if (child.icon === 'feather-users') {
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-3-3.87"></path><path d="M9 21v-2a4 4 0 0 1 3-3.87"></path><path d="M7 7a4 4 0 1 1 8 0 4 4 0 0 1-8 0z"></path></svg>
                      }
                      @if (child.icon === 'feather-shield') {
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                      }
                      @if (child.icon === 'feather-sliders') {
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="12" x2="15" y2="12"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>
                      }
                      @if (child.icon === 'feather-layers') {
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 2 17 12 22 22 17 22 7 12 2"></polygon><polyline points="2 7 12 12 22 7"></polyline><polyline points="2 17 12 12 22 17"></polyline></svg>
                      }
                      @if (child.icon === 'feather-shopping-cart') {
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                      }
                    </span>
                    @if (shouldShowExpanded) {
                      <span class="nav-text">{{ child.label }}</span>
                    }
                  </a>
                </li>
                }
              </ul>
            }
          } @else {
            <!-- Item normal -->
            <a 
              [routerLink]="item.route" 
              [class.active]="item.route && isRouteActive(item.route)"
              class="nav-link"
              [attr.title]="!shouldShowExpanded ? item.label : null"
              (click)="onMenuItemClick()"
            >
              <span class="nav-icon">
                @if (item.icon === 'feather-home') {
                  <svg width="28" height="28" fill="none" stroke="rgba(100,116,139,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                }
                @if (item.icon === 'feather-users') {
                  <svg width="28" height="28" fill="none" stroke="rgba(100,116,139,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-3-3.87"></path><path d="M9 21v-2a4 4 0 0 1 3-3.87"></path><path d="M7 7a4 4 0 1 1 8 0 4 4 0 0 1-8 0z"></path></svg>
                }
                @if (item.icon === 'feather-file-text') {
                  <svg width="28" height="28" fill="none" stroke="rgba(100,116,139,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                }
                @if (item.icon === 'feather-search') {
                  <svg width="28" height="28" fill="none" stroke="rgba(100,116,139,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                }
                @if (item.icon === 'feather-bar-chart-2') {
                  <svg width="28" height="28" fill="none" stroke="rgba(100,116,139,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                }
                @if (item.icon === 'feather-cog') {
                  <svg width="28" height="28" fill="none" stroke="rgba(100,116,139,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 17.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 6.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                }
              </span>
              @if (shouldShowExpanded) {
                <span class="nav-text">{{ item.label }}</span>
              }
            </a>
          }
        </li>
        }
      </ul>
    </nav>
  </div>

  <!-- Footer -->
  <div class="sidebar-footer">
    <button 
      (click)="logout()" 
      class="logout-btn"
      [attr.title]="!shouldShowExpanded ? 'Sair' : null"
    >
      <span class="logout-icon">⏻</span>
      @if (shouldShowExpanded) {
        <span class="logout-text">Sair</span>
      }
    </button>
  </div>
</nav>
}